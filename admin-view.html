<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>All Poems – The Blunt Quill</title>
  <style>
    body {
      font-family: Georgia, serif;
      background: #f8f4f0;
      margin: 0;
      padding: 0;
    }

    nav {
      background-color: #3e2d24;
      color: white;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 2rem;
      flex-wrap: wrap;
    }

    nav .nav-left {
      font-size: 1.2rem;
    }

    nav .nav-links a {
      color: white;
      margin-right: 1.5rem;
      text-decoration: none;
      font-weight: bold;
    }

    nav .search-bar {
      margin-top: 0.5rem;
      width: 100%;
      max-width: 300px;
    }

    nav .search-bar input {
      width: 100%;
      padding: 0.4rem 0.8rem;
      font-size: 0.9rem;
      border-radius: 5px;
      border: none;
    }

    .container {
      padding: 2rem;
      max-width: 900px;
      margin: auto;
    }

    .poem-card {
      background: white;
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 1.2rem;
      margin-bottom: 1.5rem;
    }

    .poem-card h3 {
      margin: 0 0 0.5rem;
      color: #5c3a2c;
    }

    .poem-meta {
      font-size: 0.9rem;
      color: #666;
      margin-bottom: 1rem;
    }

    .poem-content {
      border-top: 1px solid #ddd;
      padding-top: 1rem;
      margin-top: 1rem;
    }

    .poem-actions {
      margin-top: 1rem;
      display: flex;
      gap: 1rem;
    }

    .poem-actions button {
      padding: 0.5rem 1rem;
      font-size: 0.9rem;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .edit-btn {
      background-color: #f0ad4e;
      color: white;
    }

    .delete-btn {
      background-color: #d9534f;
      color: white;
    }
  </style>
</head>
<body>
  <nav>
    <div class="nav-left nav-links">
      <a href="/">Home</a>
      <a href="admin/admin.html">Admin Panel</a>
    </div>
    <div class="search-bar">
      <input type="text" id="searchInput" placeholder="Search poems...">
    </div>
  </nav>

  <div class="container">
    <div id="poemList"></div>
  </div>

  <!-- Firebase & Logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD5V9YJaXFD-d24ec2DrsHE1Y9lyG9H7lQ",
      authDomain: "the-blunt-quill.firebaseapp.com",
      projectId: "the-blunt-quill",
      storageBucket: "the-blunt-quill.appspot.com",
      messagingSenderId: "324668891059",
      appId: "1:324668891059:web:ea089f7d8747df130a75c6"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const poemList = document.getElementById('poemList');
    const searchInput = document.getElementById('searchInput');

    let poems = [];

    async function loadPoems() {
      const snapshot = await getDocs(collection(db, "poems"));
      poems = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
      renderPoems(poems);
    }

    function renderPoems(data) {
      poemList.innerHTML = "";
      data.forEach(poem => {
        const card = document.createElement('div');
        card.className = "poem-card";
        card.innerHTML = `
          <h3>${poem.title}</h3>
          <div class="poem-meta">
            by ${poem.author} ${poem.timestamp ? " — " + new Date(poem.timestamp).toLocaleString() : ""}
          </div>
          <div class="poem-content">${poem.content}</div>
          <div class="poem-actions">
            <button class="edit-btn" onclick="editPoem('${poem.id}')">Edit</button>
            <button class="delete-btn" onclick="deletePoem('${poem.id}')">Delete</button>
          </div>
        `;
        poemList.appendChild(card);
      });
    }

    searchInput.addEventListener("input", () => {
      const term = searchInput.value.toLowerCase();
      const filtered = poems.filter(p =>
        p.title.toLowerCase().includes(term) || p.author.toLowerCase().includes(term)
      );
      renderPoems(filtered);
    });

    window.deletePoem = async (id) => {
      if (confirm("Are you sure you want to delete this poem?")) {
        await deleteDoc(doc(db, "poems", id));
        poems = poems.filter(p => p.id !== id);
        renderPoems(poems);
      }
    }


 window.editPoem = (id) => {
  window.location.href = `admin/edit-poem.html?id=${id}`;
};

    loadPoems();
  </script>
</body>
</html>
